<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plyr with DASH and Multiple Quality Options</title>
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
</head>
<body>
    <!-- Video Player Container -->
    <video id="video-player" controls crossorigin playsinline></video>

    <!-- Plyr JS -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <!-- DASH.js -->
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>

    <script>
        // Function to get URL parameters
        function getURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                videoId: urlParams.get('video'),     // Extract 'video' parameter
                quality: urlParams.get('quality'),   // Extract 'quality' parameter
            };
        }

        // Get the URL parameters
        const params = getURLParams();
        console.log('Video ID:', params.videoId);  // For debugging
        console.log('Quality:', params.quality);   // For debugging

        // Initialize the video element and the DASH.js player
        const video = document.getElementById('video-player');
        const dash = dashjs.MediaPlayer().create();

        // Set the DASH manifest URL dynamically based on the 'video' URL parameter
        const manifestUrl = params.video ? `https://vkvsd14.okcdn.ru/cmaf/7465941011175/sig/D1esK-EFWhc/srcIp/13.202.136.237/urls/185.226.53.94/expires/1734812039320/clientType/13/srcAg/CHROME/fromCache/1/mid/9161388141543/id/7465941011175/get/dash_9161388141543.yi5Gc1pbmz0.mpd` : 'https://default-dash-url.mpd';
        
        // Initialize DASH.js player with the chosen manifest
        dash.initialize(video, manifestUrl, true);  // The 'true' enables auto-switching between qualities

        // Set up Plyr player
        const player = new Plyr(video);

        // Optional: Sync Plyr and DASH.js for better control
        video.addEventListener('play', () => dash.play());
        video.addEventListener('pause', () => dash.pause());

        // Event to detect quality change
        dash.on(dashjs.MediaPlayer.events.PERIOD_SWITCHED, function () {
            const currentQuality = dash.getQualityFor('video');
            console.log('Current quality level:', currentQuality);
        });

        // Optional: Control quality levels manually if needed (e.g., using the 'quality' parameter)
        if (params.quality) {
            // Find the quality index based on the 'quality' parameter (e.g., 'low', 'medium', 'high')
            const availableQualities = dash.getBitrateInfoListFor('video');
            const qualityIndex = availableQualities.findIndex(q => q.height === parseInt(params.quality, 10));
            
            if (qualityIndex !== -1) {
                dash.setQualityFor('video', qualityIndex);  // Set the desired quality based on the 'quality' param
            }
        }

        // Access to available quality levels
        dash.on(dashjs.MediaPlayer.events.MANIFEST_LOADED, function () {
            const availableQualities = dash.getBitrateInfoListFor('video');
            console.log('Available Quality Levels:', availableQualities);
        });

        // Handle errors during DASH playback
        dash.on(dashjs.MediaPlayer.events.ERROR, function(e) {
            console.error('DASH.js Error:', e);
            alert('An error occurred while loading the video.');
        });

        // Optional: Handle DASH.js manifest loading
        dash.on(dashjs.MediaPlayer.events.MANIFEST_LOADED, function() {
            console.log('Manifest loaded successfully');
        });
    </script>
</body>
</html>
